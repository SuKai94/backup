[《Redis入门指南》](http://book.douban.com/subject/24522045/)
===

### 第一章 简介
#### 1.2 特性 
一款个人开发数据库

#### 1.2.1 存储结构
Redis是Remote Dictionary Server(远程字典服务器)的缩写，以字典结构存储数据，并允许其他应用通过TCP协议读写字典中的内容。字典中的键值除了字符串，还可以是其余数据类型。目前，Redis支持：
- 字符串类型
- 散列类型
- 列表类型
- 集合类型
- 有序集合类型

优势是查询数据库数据时，无需将几个相关表join在一起，字典结构的存储方式和对多种键值数据类型的支持使得开发者可以将程序中数据直接映射到Redis中，另一个优势是可以进行交集，并集这样的集合操作。

#### 1.2.2 内存存储与持久化
redis数据都存储在内存中，并且内存读写速度比硬盘快很多。但存在一个问题：程序退出后内存中的数据将会丢失，不过redis提供了持久化的支持，可以将内存中的数据异步写入到硬盘中，同时不影响继续提供服务。

#### 1.2.3 功能丰富
redis虽然是作为数据库开发的，但是由于其丰富的功能，更多人将其作为缓存，队列系统。redis可以为每个键设置生存时间(TTL)，生存时间到了就自动被删除，这一功能配合出色的性能让redis作为缓存系统使用，而且redis支持持久化和丰富数据类型，使其成为Memcached的有力竞争者。

但是Memcached支持多线程，redis是单线程模式，前者在多核服务器上性能更高。作为缓存系统，redis还可以限定数据占用的最大内存空间，在数据达到空间限制后，按照一定的规则自动淘汰不需要的键。

初次之外，redis的列表类型可以用来实现队列，并且支持阻塞式读取，可以很容易实现一个高性能的优先级队列。

#### 1.2.4 简单稳定
redis使用命令来读取数据，将相当于SQL语句。redis还提供了几十种不同编程语言的客户端库，这些库都很好地封装了redis命令，使得在程序中更好的和redis交互

### 第二章 准备
#### 2.1 安装
#### 2.2 启动和停止redis
安装完redis的下一步就是启动它，先来看看redis包含的可执行文件有哪些：
- redis-server：redis服务器
- redis-cli：redis命令行客户端
- redis-benchmark：redis性能测试工具
- redis-check-aof：AOF文件修复工具
- redis-check-dump：RDB文件检查工具

#### 2.2.1 启动redis
有：直接启动和初始化脚本启动两种方式，分为适用于开发环境和生产环境

1. 直接启动：redis-server，默认端口是6379，可以通过redis-server --port 8888指定端口
2. 初始化脚本启动redis，在redis源代码目录的utils文件夹下有一个名为redis_init_script的初始化脚本

#### 2.2.2 停止redis
考虑到redis有可能在将内存数据同步到硬盘，强制终止redis可能会造成数据丢失，正确的是发送shutdown命令：

```bash
redis-cli shutdown
```

当redis接受到shutdown之后，会先断开所有客户端连接，然后根据配置执行持久化，最后完成退出。redis也可以妥善处理sigterm信号，所以使用“kill redis进程id”也可以达到同样效果

#### 2.3 redis命令行客户端
是我们学习和测试redis的重要工具

#### 2.4 配置
我们之前通过redis-server的启动参数port设置了redis的端口号，除此之外，redis还支持其他配置选项，如是否开启持久化，日志级别等。由于配置的选项较多，通过启动参数设置这些选项并不方便，所以redis支持通过配置文件来设置这些选项。

```bash
redis-server /path/to/redis.conf
```

通过启动参数传递同名的配置文件选项会覆盖配置文件中相应的参数：

```bash
redis-server /path/th/redis.conf --loglevel warning
```

redis提供了配置文件的模板redis.conf，在源代码目录的根目录。除此之外，还可以在redis运行时通过config set命令在不重新启动redis的情况下动态修改redis配置。

#### 2.5 多数据库
实际上redis实例提供了多个用来存储数据的字典，客户端可以指定将数据存储在哪个字典中，与我们熟知的一个关系数据库实例可以创建多个数据库类似，所以可以将其中的每个字典都理解成一个独立的数据库。每个数据库从0开始递增数字命名，redis默认支持16个数据库。

然而，又和我们理解的数据库有区别：redis不支持自定义数据库名，也不支持为每个数据库设置密码，所以一个客户端要么可以访问全部数据，要么一个访问权限都没有。更重要的一点是，多个数据库之间并不是完全隔离的，不同的应用应该使用不同的redis实例，而非不同的数据库。

### 第三章 入门
#### 3.1 热身
#### 3.2 字符串类型
一个字符串类型键允许存储的数据最大容量是512MB。
#### 3.2.2 命令
1. 赋值与取值

```bash
set key value
get key
```

2. 递增数字

字符串类型可以存储任何形式的字符串，当存储的字符串是整数形式时，redis提供一个incr命令，让当前键值递增，并返回递增后的值：

`incr bar`

#### 3.2.3 实践
文章访问量统计需要生成自赠的ID，在关系型数据库里面，我们可以通过设置字段属性为auto_increment，redis中可以通过另一种模式实现：对于每一类对象使用名为对象类型(复数形式):count的键来存储当前类型对象的数量。

`$ postID = incr posts:count`

#### 3.2.4 命令拾遗
1. 增加指定整数

`incrby key increment`

2. 减少指定整数

`decr key`

`decrby key increment`

3. 增加指定浮点数

`incrbyfloat key increment`

4. 向尾部追加值

`append key value`

如果键不存在，就将键值设为value，返回值是追加后字符串的长度

5. 获取字符串的长度

`strlen key`

6. 同时获取/设置多个键值

`mset key1 v1 key2 v2 ...`

`mget key1 key2 ...`

7. 位操作
- `getbit key offset`：获得一个字符串类型键指定位置(offset)的二进制位的值，索引从0开始;如果索引超过了键值的二进制位的实际长度，则默认位值为0
- `setbit key offset value`：设置字符串类型键指定位置的二进制位的值，返回值是该位置的旧值。如果设置的位置超过了键值二进制位的长度，setbit命令将自动将中间的二进制位设置为0，同理设置一个不存在键的指定二进制位的值，将自动将其前面的位赋值为0。
- `bitcount key`：获得字符串类型键中值是1的二进制位个数，可以通过参数限制统计的字节范围，如果只希望统计前两个字节：`bitcount key 0 1`
- `bitop or res key1 kye2`：将字符串key1和key2执行位或操作，将结果存放在res键中。总结就是bitop可以对多个字符串类型键进行位操作，有and,or,xor,not。

利用位操作可以很紧凑地存储布尔值
